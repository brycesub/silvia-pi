// MIT License: https://raw.githubusercontent.com/joewalnes/smoothie/master/LICENSE.txt
//Smoothie Charts - http://smoothiecharts.org/
//(c) 2010-2013, Joe Walnes
//    2013-2014, Drew Noakes
!function(e){function t(e){this.options=a.extend({},t.defaultOptions,e),this.clear()}function i(e){this.options=a.extend({},i.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0}var a={extend:function(){arguments[0]=arguments[0]||{};for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&("object"==typeof arguments[e][t]?arguments[e][t]instanceof Array?arguments[0][t]=arguments[e][t]:arguments[0][t]=a.extend(arguments[0][t],arguments[e][t]):arguments[0][t]=arguments[e][t]);return arguments[0]}};t.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},t.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},t.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var t=this.data[e][1];t>this.maxValue&&(this.maxValue=t),t<this.minValue&&(this.minValue=t)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},t.prototype.append=function(e,t,i){for(var a=this.data.length-1;a>=0&&this.data[a][0]>e;)a--;-1===a?this.data.splice(0,0,[e,t]):this.data.length>0&&this.data[a][0]===e?i?(this.data[a][1]+=t,t=this.data[a][1]):this.data[a][1]=t:a<this.data.length-1?this.data.splice(a+1,0,[e,t]):this.data.push([e,t]),this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},t.prototype.dropOldData=function(e,t){for(var i=0;this.data.length-i>=t&&this.data[i+1][0]<e;)i++;0!==i&&this.data.splice(0,i)},i.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2},horizontalLines:[]},i.AnimateCompatibility=function(){var e=function(e,t){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(function(){e((new Date).getTime())},16)};return i.call(window,e,t)},t=function(e){var t=window.cancelAnimationFrame||function(e){clearTimeout(e)};return t.call(window,e)};return{requestAnimationFrame:e,cancelAnimationFrame:t}}(),i.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},i.prototype.addTimeSeries=function(e,t){this.seriesSet.push({timeSeries:e,options:a.extend({},i.defaultSeriesPresentationOptions,t)}),e.options.resetBounds&&e.options.resetBoundsInterval>0&&(e.resetBoundsTimerId=setInterval(function(){e.resetBounds()},e.options.resetBoundsInterval))},i.prototype.removeTimeSeries=function(e){for(var t=this.seriesSet.length,i=0;t>i;i++)if(this.seriesSet[i].timeSeries===e){this.seriesSet.splice(i,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},i.prototype.getTimeSeriesOptions=function(e){for(var t=this.seriesSet.length,i=0;t>i;i++)if(this.seriesSet[i].timeSeries===e)return this.seriesSet[i].options},i.prototype.bringToFront=function(e){for(var t=this.seriesSet.length,i=0;t>i;i++)if(this.seriesSet[i].timeSeries===e){var a=this.seriesSet.splice(i,1);this.seriesSet.push(a[0]);break}},i.prototype.streamTo=function(e,t){this.canvas=e,this.delay=t,this.start()},i.prototype.resize=function(){if(this.options.enableDpiScaling&&window&&1!==window.devicePixelRatio){var e=window.devicePixelRatio,t=parseInt(this.canvas.getAttribute("width")),i=parseInt(this.canvas.getAttribute("height"));this.originalWidth&&Math.floor(this.originalWidth*e)===t||(this.originalWidth=t,this.canvas.setAttribute("width",Math.floor(t*e).toString()),this.canvas.style.width=t+"px",this.canvas.getContext("2d").scale(e,e)),this.originalHeight&&Math.floor(this.originalHeight*e)===i||(this.originalHeight=i,this.canvas.setAttribute("height",Math.floor(i*e).toString()),this.canvas.style.height=i+"px",this.canvas.getContext("2d").scale(e,e))}},i.prototype.start=function(){if(!this.frame){var e=function(){this.frame=i.AnimateCompatibility.requestAnimationFrame(function(){this.render(),e()}.bind(this))}.bind(this);e()}},i.prototype.stop=function(){this.frame&&(i.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame)},i.prototype.updateValueRange=function(){for(var e=this.options,t=Number.NaN,i=Number.NaN,a=0;a<this.seriesSet.length;a++){var s=this.seriesSet[a].timeSeries;isNaN(s.maxValue)||(t=isNaN(t)?s.maxValue:Math.max(t,s.maxValue)),isNaN(s.minValue)||(i=isNaN(i)?s.minValue:Math.min(i,s.minValue))}if(null!=e.maxValue?t=e.maxValue:t*=e.maxValueScale,null!=e.minValue?i=e.minValue:i-=Math.abs(i*e.minValueScale-i),this.options.yRangeFunction){var n=this.options.yRangeFunction({min:i,max:t});i=n.min,t=n.max}if(!isNaN(t)&&!isNaN(i)){var r=t-i,l=r-this.currentValueRange,o=i-this.currentVisMinValue;this.isAnimatingScale=Math.abs(l)>.1||Math.abs(o)>.1,this.currentValueRange+=e.scaleSmoothing*l,this.currentVisMinValue+=e.scaleSmoothing*o}this.valueRange={min:i,max:t}},i.prototype.render=function(e,t){var i=(new Date).getTime();if(!this.isAnimatingScale){var a=Math.min(1e3/6,this.options.millisPerPixel);if(i-this.lastRenderTimeMillis<a)return}this.resize(),this.lastRenderTimeMillis=i,e=e||this.canvas,t=t||i-(this.delay||0),t-=t%this.options.millisPerPixel;var s=e.getContext("2d"),n=this.options,r={top:0,left:0,width:e.clientWidth,height:e.clientHeight},l=t-r.width*n.millisPerPixel,o=function(e){var t=e-this.currentVisMinValue;return 0===this.currentValueRange?r.height:r.height-Math.round(t/this.currentValueRange*r.height)}.bind(this),h=function(e){return n.scrollBackwards?Math.round((t-e)/n.millisPerPixel):Math.round(r.width-(t-e)/n.millisPerPixel)};if(this.updateValueRange(),s.font=n.labels.fontSize+"px "+n.labels.fontFamily,s.save(),s.translate(r.left,r.top),s.beginPath(),s.rect(0,0,r.width,r.height),s.clip(),s.save(),s.fillStyle=n.grid.fillStyle,s.clearRect(0,0,r.width,r.height),s.fillRect(0,0,r.width,r.height),s.restore(),s.save(),s.lineWidth=n.grid.lineWidth,s.strokeStyle=n.grid.strokeStyle,n.grid.millisPerLine>0){s.beginPath();for(var u=t-t%n.grid.millisPerLine;u>=l;u-=n.grid.millisPerLine){var m=h(u);n.grid.sharpLines&&(m-=.5),s.moveTo(m,0),s.lineTo(m,r.height)}s.stroke(),s.closePath()}for(var d=1;d<n.grid.verticalSections;d++){var c=Math.round(d*r.height/n.grid.verticalSections);n.grid.sharpLines&&(c-=.5),s.beginPath(),s.moveTo(0,c),s.lineTo(r.width,c),s.stroke(),s.closePath()}if(n.grid.borderVisible&&(s.beginPath(),s.strokeRect(0,0,r.width,r.height),s.closePath()),s.restore(),n.horizontalLines&&n.horizontalLines.length)for(var f=0;f<n.horizontalLines.length;f++){var g=n.horizontalLines[f],p=Math.round(o(g.value))-.5;s.strokeStyle=g.color||"#ffffff",s.lineWidth=g.lineWidth||1,s.beginPath(),s.moveTo(0,p),s.lineTo(r.width,p),s.stroke(),s.closePath()}for(var v=0;v<this.seriesSet.length;v++){s.save();var S=this.seriesSet[v].timeSeries,w=S.data,x=this.seriesSet[v].options;S.dropOldData(l,n.maxDataSetLength),s.lineWidth=x.lineWidth,s.strokeStyle=x.strokeStyle,s.beginPath();for(var y=0,b=0,V=0,N=0;N<w.length&&1!==w.length;N++){var T=h(w[N][0]),P=o(w[N][1]);if(0===N)y=T,s.moveTo(T,P);else switch(n.interpolation){case"linear":case"line":s.lineTo(T,P);break;case"bezier":default:s.bezierCurveTo(Math.round((b+T)/2),V,Math.round(b+T)/2,P,T,P);break;case"step":s.lineTo(T,V),s.lineTo(T,P)}b=T,V=P}w.length>1&&(x.fillStyle&&(s.lineTo(r.width+x.lineWidth+1,V),s.lineTo(r.width+x.lineWidth+1,r.height+x.lineWidth+1),s.lineTo(y,r.height+x.lineWidth),s.fillStyle=x.fillStyle,s.fill()),x.strokeStyle&&"none"!==x.strokeStyle&&s.stroke(),s.closePath()),s.restore()}if(!n.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var M=n.yMaxFormatter(this.valueRange.max,n.labels.precision),k=n.yMinFormatter(this.valueRange.min,n.labels.precision),F=n.scrollBackwards?0:r.width-s.measureText(M).width-2;s.fillStyle=n.labels.fillStyle,s.fillText(M,F,n.labels.fontSize),s.fillText(k,F,r.height-2)}if(n.timestampFormatter&&n.grid.millisPerLine>0)for(var R=n.scrollBackwards?s.measureText(k).width:r.width-s.measureText(k).width+4,u=t-t%n.grid.millisPerLine;u>=l;u-=n.grid.millisPerLine){var m=h(u);if(!n.scrollBackwards&&R>m||n.scrollBackwards&&m>R){var A=new Date(u),B=n.timestampFormatter(A),L=s.measureText(B).width;R=n.scrollBackwards?m+L+2:m-L-2,s.fillStyle=n.labels.fillStyle,n.scrollBackwards?s.fillText(B,m,r.height-2):s.fillText(B,m-L,r.height-2)}}s.restore()},i.timeFormatter=function(e){function t(e){return(10>e?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},e.TimeSeries=t,e.SmoothieChart=i}("undefined"==typeof exports?this:exports);
